---
- hosts: k8s_master:k8s_nodes
  tasks:
    - name: Installing nfs-common.
      become: yes
      apt:
        name: nfs-common


- hosts: localhost
  tasks:
    - name: Deploying the Role Binding for the NFS Provisioner to Kubernetes.
      k8s:
        definition: "{{ lookup('template', '../files/templates/nfs_role_binding.yml.j2') | from_yaml_all | list }}"        

    - name: Deploying the NFS Provisioner to Kubernetes.
      k8s:
        definition: "{{ lookup('template', '../files/templates/nfs_provisioner.yml.j2') | from_yaml_all | list }}"        

    - name: Deploying the NFS Storage Class to Kubernetes.
      k8s:
        definition: "{{ lookup('template', '../files/templates/nfs_storage_class.yml.j2') | from_yaml_all | list }}"        
